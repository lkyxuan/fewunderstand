name: Notify Dev Branch Update

on:
  push:
    branches:
      - dev

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Lark Notification
        env:
          REPO: ${{ github.repository }}
          ACTOR: ${{ github.actor }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
          COMMIT_MSG: ${{ github.event.head_commit.message }}
        run: |
          # åªå– commit message çš„ç¬¬ä¸€è¡Œ
          FIRST_LINE=$(echo "$COMMIT_MSG" | head -1)

          # æ„å»º JSON payload
          PAYLOAD=$(jq -n \
            --arg repo "$REPO" \
            --arg actor "$ACTOR" \
            --arg msg "$FIRST_LINE" \
            --arg url "$COMMIT_URL" \
            '{
              msg_type: "interactive",
              card: {
                header: {
                  title: { tag: "plain_text", content: "ğŸš€ Dev åˆ†æ”¯å·²æ›´æ–°" },
                  template: "blue"
                },
                elements: [
                  {
                    tag: "div",
                    text: {
                      tag: "lark_md",
                      content: "**ä»“åº“**: \($repo)\n**æäº¤è€…**: \($actor)\n**æäº¤ä¿¡æ¯**: \($msg)"
                    }
                  },
                  {
                    tag: "action",
                    actions: [{
                      tag: "button",
                      text: { tag: "plain_text", content: "æŸ¥çœ‹æäº¤" },
                      type: "primary",
                      url: $url
                    }]
                  }
                ]
              }
            }')

          # å‘é€é€šçŸ¥
          curl -X POST "https://open.larksuite.com/open-apis/bot/v2/hook/9a925d0c-d4d6-4107-90d1-e9a42e8f0111" \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD"
